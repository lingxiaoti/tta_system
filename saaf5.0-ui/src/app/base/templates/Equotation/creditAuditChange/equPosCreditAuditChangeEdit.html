<div ng-controller="equPosCreditAuditChangeEditCtrl" class="bigdata">
    <div id="processForm"
         data-api-post="saveEquPosCreditAuditChange"
         data-api-get="findEquPosCreditAuditChangeInfo"
         data-api-update="saveEquPosCreditAuditChange">
    </div>
    <div>
        <!--------------------- 按钮--->

        <div class="bg-gray-white p5">
            <div class=" pull-right ml10">

                <div class="btn-group btn-group-xs">
                    <button class="btn btn-default" permission-btn="btnSave" data-validate-form="userForm"></button>
                </div>
            </div>
            <div class="btn-group btn-group-xs ">
                <button class="btn btn-primary" ng-click="fullWindow($event)"><i class="fa fa-square-o"></i>{{$l('数据全屏')}}
                </button>
            </div>
        </div>
        <!---------------------  / .按钮  --->
        <div main-scroll-style data-des="此节点必需－用户计算滚动区域高度">
            <div class="nicescroll-height  bg-white " ng-nicescroll
                 nice-option="{{niceOpction}}"
                 data-des="此节点必需-滚动内容及指令">

                <!--------------------- 输入表单  --->


                <!--工作流集成添加TAB-->
                <ul ng-if="!urlParams.businessKey" class="nav nav-tabs mt10">
                    <li role="presentation" class="active" ng-click="tabChange('requestFundsBusiness')">
                        <a href="#requestFundsBusiness" aria-controls="requestFundsBusiness" role="tab"
                           data-toggle="tab">{{$l('业务表单')}}</a>
                    </li>
                    <li role="presentation" ng-click="tabChange('approvalHistory')">
                        <a href="#approvalHistory" aria-controls="approvalHistory" role="tab"
                           data-toggle="tab">{{$l('审批历史')}}</a>
                    </li>
                    <li role="presentation" ng-click="tabChange('opinion')">
                        <a href="#opinion" aria-controls="opinion" role="tab" data-toggle="tab">{{$l('流程图')}}</a>
                    </li>
                    <li ng-show="tabAction=='opinion'">
                        <ul>
                            <li style="list-style-type: square;float: left;font-size: 20px;color: #cc0033;margin-right: 30px;text-indent: -7px;">
                                <span style="font-size: 14px;">{{$l('未接收')}}</span>
                            </li>
                            <li style="list-style-type: square;float: left;font-size: 20px;color: #ff6600;margin-right: 30px;text-indent: -7px;">
                                <span style="font-size: 14px;">{{$l('办理中')}}</span>
                            </li>
                            <li style="list-style-type: square;float: left;font-size: 20px;color: #339933;margin-right: 30px;text-indent: -7px;">
                                <span style="font-size: 14px;">{{$l('已办结')}}</span>
                            </li>
                            <li style="list-style-type: square;float: left;font-size: 20px;color: #666666;margin-right: 30px;text-indent: -7px;">
                                <span style="font-size: 14px;">{{$l('预设步骤')}}</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div ng-show="tabAction== 'requestFundsBusiness'" role="tabpanel" class="tab-pane active"
                     id="requestFundsBusiness"
                     style="border: 0;width:100%;height: 100%;overflow-y: auto;">
                    <div class=" mt10 pb5  oh"
                         data-des="此节点必需－用于识别输入表单的指令">
                        <form id="userForm" name="userForm" ng-show="tabAction== 'requestFundsBusiness'">
                            <header class="col-xs-12 mb10">
                                <i class="fa fa-cog" aria-hidden="true"></i>
                                <span>{{$l('供应商信用审核导入详情')}}</span>
                                <div class="pull-right ml10">
                                    <div class="btn-group btn-group-xs ">
                                        <button class="btn btn-default" ng-if="saveFlag" type="button"
                                                ng-click="save('save')">
                                            <i class="fa fa-search" aria-hidden="true"></i>{{$l('保存')}}
                                        </button>
                                        <button class="btn btn-default" ng-if="submitFlag" type="button"
                                                ng-click="btnSubmit()">
                                            <i class="fa fa-undo" aria-hidden="true"></i>{{$l('提交')}}
                                        </button>
                                        <!--<button class="btn btn-default" ng-if="approveFlag" type="button"-->
                                                <!--ng-click="save('approve')">-->
                                            <!--<i class="fa fa-search" aria-hidden="true"></i>审批-->
                                        <!--</button>-->
                                        <!--<button class="btn btn-default" ng-if="rejectFlag" type="button"-->
                                                <!--ng-click="save('reject')">-->
                                            <!--<i class="fa fa-search" aria-hidden="true"></i>驳回-->
                                        <!--</button>-->
                                        <button class="btn btn-default" ng-if="cancelFlag" type="button"
                                                ng-click="save('cancel')">
                                            <i class="fa fa-undo" aria-hidden="true"></i>{{$l('取消')}}
                                        </button>
                                    </div>
                                    <!--<div class="btn-group btn-group-xs "    permission-buttons="btnNew,btnModify"></div>-->
                                </div>
                            </header>

                            <div class="form-group col-xs-4 col-md-4">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn"><span
                                            class="w100">{{$l('单据编号')}}:</span></label>
                                    <input type="text" class="form-control input-xs" disabled
                                           ng-model="params.changeCreditAuditCode"/>
                                </div>
                            </div>

                            <div class="form-group col-xs-4 col-md-4">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn">
                                        <span class="w100">{{$l('单据状态')}}:</span></label>
                                    <select class="form-control input-xs" ng-model="params.changeCreditAuditStatus"
                                            disabled>
                                        <option saaf-select-lookupcode="EDU_SUP_SUSPEND_STATUS"></option>
                                    </select>
                                    <span class="input-group-btn ng-scope">
                            </span>
                                </div>
                            </div>

                            <div class="form-group col-xs-4 col-md-4">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn"><span class="w100">{{$l('创建时间')}}:</span></label>
                                    <input type="text" class="form-control input-xs" disabled
                                           ng-model="params.creationDate">
                                </div>
                            </div>
                            <div class="form-group col-xs-4 col-md-4">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn"><span class="w100">{{$l('创建人')}}:</span></label>
                                    <input type="text" class="form-control input-xs" disabled
                                           ng-model="params.createdByName">
                                </div>
                            </div>
                            <div ng-if="param.businessFlag" class="form-group col-xs-4 col-md-4">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn"><span class="w100">{{$l('部门')}}:</span></label>
                                    <input type="text" class="form-control input-xs" disabled
                                           ng-model="param.deptName">
                                </div>
                            </div>
                            <div class="form-group col-xs-4 col-md-4">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn"><span
                                            class="w100">{{$l('附件')}}:</span></label>
                                    <input type="file" name="file" ng-if="params.fileId==null" ng-disabled="!saveFlag" id="file"
                                           onchange="angular.element(this).scope().uploadFile()"
                                           emms-file-upload="myFile">
                                    <span class="input-group-addon bn" ng-if="params.fileId!=null"
                                          style="width: 230px;text-align: left;height:23px;display:inline-block;">
                                    <a class="ellipsis" style="color:blue;display: block;width: 220px;"
                                       href="{{params.filePath}}"
                                       target="_blank">{{params.fileName}}
                                    </a>
                                </span>
                                    <span type="button" ng-click="changeFile()" ng-if="params.fileId!=null &&saveFlag"
                                          class="btn btn-primary btn-xs">
                                    <i class="fa fa-plus">{{$l('重新上传')}}</i>
                                </span>
                                </div>
                            </div>


                            <div class="form-group col-xs-10 col-md-10">
                                <div class="input-group input-group-xs">
                                    <label class="input-group-addon bn"><span class="w100">{{$l('备注说明')}}:</span></label>
                                    <textarea rows="2" cols="171" ng-disabled="!saveFlag"
                                              ng-model="params.remark"></textarea>
                                </div>
                            </div>
                            <!--<div class="form-group col-xs-10 col-md-10">-->
                                <!--<div class="input-group input-group-xs">-->
                                    <!--<label class="input-group-addon bn"><span class="w100">驳回原因:</span></label>-->
                                    <!--<textarea rows="2" cols="171" ng-disabled="!rejectFlag"-->
                                              <!--ng-model="params.rejectReason"></textarea>-->
                                <!--</div>-->
                            <!--</div>-->

                            <div class="form-group col-xs-12 col-md-12">

                                <div class="data-table" style="overflow-x:scroll">

                                    <label style="margin-left: 10px"></label>
                                    <!--permission-buttons="btnNew"-->
                                    <div class="btn-group btn-group-xs ml5 pull-right">
                                        <button type="button" class="btn btn-default btn-xs" ng-if="saveFlag"
                                                ng-click="addL('save')"><i
                                                class="fa fa-plus">{{$l('新增')}}</i></button>
                                    </div>
                                    <div class="btn-group btn-group-xs ml5 pull-right" permission-btn-group="btnImport"
                                         ng-style="myStyle"
                                         id="isSq">

                                        <button class="btn btn-default  a-black " ng-if="saveFlag"
                                                onclick="window.location.href='app/base/templates/Equotation/exampleFlie/creditAudit.xlsx'">
                                            <i class="fa fa-file-excel-o"></i>{{$l('导入模板下载')}}
                                        </button>

                                        <button class="btn btn-default" type="button" saaf-xls-import-component
                                                ng-if="saveFlag&&params.changeCreditAuditHId!=null"
                                                data-list-options="{
                                            supplierNumber:{headName:'供应商档案号'},
                                            supplierName:{headName:'供应商名称'},
                                            creditAuditScore:{headName:'分数'},
                                            creditAuditResule:{headName:'结果'},
                                            startDateActive:{headName:'有效时间从'},
                                            endDateActive:{headName:'有效时间至'},
                                            }"
                                                data-url="saveImportChange"
                                                data-toggle="modal"
                                                data-message="分数为CR1至CR7,结果为合格或不合格"
                                                data-info="{date:'{{params.changeCreditAuditHId}}',dataTable:'{{dataTable.data}}'}"
                                                data-after-action="dataTable.getData()"
                                                data-message="">
                                            <i class="fa fa-upload" aria-hidden="true"></i>{{$l('EXCEL导入')}}
                                        </button>
                                    </div>

                                    <table saaf-table="dataTable"
                                           class="table table-bordered table-hover table-condensed   "
                                           data-url="findEquPosCreditAuditChangeL"

                                           data-params="params"
                                           data-checked-type="radio"
                                           data-auto-get-data="false"
                                           data-page-rows="10">
                                        <thead class="bg-gray-white" style="background-color: #E2EFEF">
                                        <tr class="text-center">
                                            <th>{{$l('序号')}}</th>
                                            <th>{{$l('属性')}}</th>
                                            <th>{{$l('供应商档案号')}}</th>
                                            <th>{{$l('供应商名称')}}</th>
                                            <th>&nbsp;&nbsp&nbsp;&nbsp&nbsp;&nbsp&nbsp;&nbsp{{$l('分数')}}&nbsp;&nbsp&nbsp;&nbsp&nbsp;&nbsp&nbsp;&nbsp</th>
                                            <th>&nbsp;&nbsp;&nbsp&nbsp;&nbsp&nbsp&nbsp;&nbsp{{$l('结果')}}&nbsp;&nbsp;&nbsp&nbsp;&nbsp&nbsp&nbsp;&nbsp</th>
                                            <th>{{$l('有效期从')}}</th>
                                            <th>{{$l('有效期至')}}</th>
                                            <th>{{$l('附件')}}</th>
                                            <th>{{$l('操作人')}}</th>
                                            <th>{{$l('最后更新时间')}}</th>
                                            <th>{{$l('操作')}}</th>
                                        </tr>
                                        </thead>
                                        <tbody ng-show="dataTable.data">
                                        <tr class="text-center" ng-repeat="row in dataTable.data"
                                            ng-class="{'active':dataTable.data.selectRow==$index}"
                                            ng-click="dataTable.data.selectRow=$index;
                                        dataTable.data.selectRowData =row;">

                                            <td ng-bind="$index+1" class="w50">1</td>
                                            <!--属性-->
                                            <td><input type="text" class="form-control input-xs" disabled
                                                       style="width: 150px;"
                                                       ng-model="row.sceneTypeName">
                                            </td>
                                            </td>
                                            <!--供应商档案号-->
                                            <td>
                                                <div class="input-group input-group-xs">
                                                    <input type="text" class="form-control input-xs"
                                                           style="width: 150px;"
                                                           ng-disabled="!saveFlag" ng-model="row.supplierNumber">
                                                    <span class="input-group-btn">
                                                <button class="btn btn-default"
                                                        ng-click="getSupplierCode($index)" ng-disabled="!saveFlag"
                                                        type="button">
                                                    <i class="fa fa-search" aria-hidden="true"></i>
                                                </button>
                                            </span></div>
                                            </td>
                                            </td>
                                            <!--供应商名称-->
                                            <td><input type="text" class="form-control input-xs" disabled
                                                       style="width: 150px;"
                                                       ng-model="row.supplierName">
                                            </td>
                                            <!--分数-->
                                            <td>
                                                <select class="form-control input-xs" ng-model="row.creditAuditScore"
                                                        style="width: 80px;" ng-disabled="!saveFlag"
                                                        ng-change="changeLineScore(row)">
                                                    <option saaf-select-lookupcode="EQU_CREDIT_AUDIT_SCORE"></option>
                                                </select>
                                            </td>
                                            <!--结果-->
                                            <td>
                                                <select class="form-control input-xs" ng-model="row.creditAuditResule"
                                                        style="width: 80px;" ng-disabled="!saveFlag">
                                                    <option saaf-select-lookupcode="EQU_CREDIT_AUDIT_RESULT"></option>
                                                </select>
                                            </td>
                                            <!--有效期从-->
                                            <td><input type="text" class="form-control input-xs" style="width: 150px;"
                                                       data-enddate="{{row.endDateActive}}" ng-disabled="!saveFlag"
                                                       date-time-picker data-date-format="yyyy-mm-dd" data-min-View="2"
                                                       placeholder="" ng-model="row.startDateActive">
                                            </td>
                                            <!--有效期至-->
                                            <td><input type="text" class="form-control input-xs" style="width: 150px;"
                                                       data-stratdate="{{row.startDateActive}}" ng-disabled="!saveFlag"
                                                       date-time-picker data-date-format="yyyy-mm-dd" data-min-View="2"
                                                       placeholder="" ng-model="row.endDateActive"></td>
                                            <!--附件-->

                                            <td class="text-left">
                                                <div class="btn-group btn-group-xs" style="">
                                                    <input type="file" name="file"
                                                           ng-if="row.fileId==null  || row.fileId == ''"
                                                           ng-disabled="!saveFlag"
                                                           id="file{{row.index}}"
                                                           emms-file-upload="myFile"
                                                           onchange="angular.element(this).scope().uploadProfile()">
                                                    <span class="input-group-addon bn"
                                                          ng-if="row.fileId!=null && row.fileId!=''"
                                                          style="width: 230px;text-align: left;height:23px;display:inline-block;">
                                                    <a class="ellipsis" style="color:blue;display: block;width: 220px;"
                                                       href="{{row.filePath}}"
                                                       target="_blank">{{row.fileName}}
                                                    </a>&nbsp;&nbsp;
                                                </span>
                                                </div>
                                                <div class="btn-group btn-group-xs" style="margin-right: 16px;">
                                                    <button type="button" ng-click="changeFile(row)"
                                                            class="btn btn-primary btn-xs"
                                                            ng-if="(row.fileId!=null && row.fileId != '')&&saveFlag">
                                                        <i class="fa fa-plus">{{$l('重新上传')}}</i>
                                                    </button>
                                                </div>
                                            </td>
                                            <!--操作人-->
                                            <td><input type="text" class="form-control input-xs" disabled
                                                       style="width: 100px;"
                                                       ng-model="row.createdByName"></td>
                                            <!--最后更新时间-->
                                            <td><input type="text" class="form-control input-xs" disabled
                                                       style="width: 150px;"
                                                       ng-model="row.lastUpdateDate"></td>
                                            <!--删除-->
                                            <td>
                                                <button class="btn btn-success btn-xs" type="button" ng-if="saveFlag"
                                                        ng-click="deleteData(row,$index)"
                                                ><i class="fa fa-trash fa-lg"></i></button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <div saaf-table-tfoot="dataTable" ng-show="dataTable.data.length>0"></div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div ng-show="tabAction== 'approvalHistory'" role="tabpanel" class="tab-pane"
                     id="approvalHistory"
                     style="border: 0;width:100%;height: 100%;overflow-y: auto;">
                    <div class="pl15 pr15 pr">
                        <h5><span class="fa  fa-pencil-square-o"></span>{{$l('审批历史')}}</h5>
                        <div base-data-table="taskTable" id="taskTable"
                             data-url="processFindHistoricActivities"
                             data-page-size="20"
                             data-onload="historicListLoad"
                             data-auto-request="true"
                             ng-params="processInstanceParams"
                             data-legend='[{"value": "taskName","name": "节点名称",style:"width:10%"},
                                 {"value": "userFullName","name": "处理人",style:"width:16%;"},
                                 {"value": "his_detail_option","name": "处理结果",style:"width:8%;"},
                                 {"value": "his_detail_opinion","name": "审批意见",nowrap:false,"maxWidth":"700px"},
                                 {"value": "startTime","name": "审批开始时间",style:"width:136px;"},
                                 {"value": "endTime","name": "审批结束时间",style:"width:136px;"}]'>
                        </div>
                    </div>
                </div>
                <div ng-if="!urlParams.businessKey" ng-show="tabAction== 'opinion'" role="tabpanel"
                     class="tab-pane "
                     id="opinion"
                     style="border: 0;width:100%;height: 100%; overflow: hidden;position: relative;">
                    <div id="processImg" style="width: 100%;height:100%; overflow: auto;">{{$l('流程图加载中，请稍候...')}}</div>
                </div>
            </div>
        </div>
    </div>


    <div lov-list="cityLov" role="dialog" data-title="选择供应商信息" id="supplierLov" ng-model="current.em"
         data-url="findSupplierLov"
         data-dynamic-params=''
         data-params={{param}}
         data-callback="selectSupplierLov"
         data-auto-request="false"
         data-return-type="key"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-checked-type="radio"
         data-keys="{'key':'supplierNumber','value':'supplierNumber','name':'供应商档案'}"
         data-show-index="false"
         data-type="competitor"
         data-other-column="[{'name':'供应商名称','key':'supplierName'}]"
         data-search-key="[{'key':'supplierNumber','placeholder':'供应商档案'},
                          {'key':'supplierName','placeholder':'供应商名称'}]">
    </div>

    <div lov-list="cityLov" role="dialog" data-title="选择供应商资质" id="qualificationLov" ng-model="current.em"
         data-url="findQualificationAuditLov"
         data-dynamic-params=''
         data-params={{params}}
         data-callback="selectQualificationLov"
         data-auto-request="true"
         data-return-type="key"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-checked-type="radio"
         data-keys="{'key':'qualificationNumber','value':'qualificationNumber','name':'资质审查单据号'}"
         data-show-index="false"
         data-type="competitor"
         data-other-column="[{'name':'资质审查单据号','key':'qualificationNumber'}]"
         data-search-key="[{'key':'qualificationNumber','placeholder':'资质审查单据号'}]"
    >
    </div>
</div>
</div>