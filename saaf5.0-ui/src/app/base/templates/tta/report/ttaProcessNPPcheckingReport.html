<div ng-controller="ttaProcessNPPcheckingReportCtrl" class="gridtable">
    <div class="form bg-white" inner-frame data-des="此节点必需－内框页面的指令">
        <!--------------------- 按钮--->
        <div class="bg-gray-white p5">
            <div class=" pull-right ml10">
                <div class="btn-group btn-group-xs ml10" id="outputButton">
                    <button class="btn btn-default" type="button" ng-click="search()">
                        <i class="fa fa-search" aria-hidden="true"></i>{{$l('搜索')}}
                    </button>

                    <!--<div class="btn-group btn-group-xs ml10" permission-buttons="batchRejected,batchApproval">-->
                    <div class="btn-group btn-group-xs ml10">
                        <button class="btn btn-default" type="button" ng-click="batchApproval()"  ng-disabled="!dataSummary.selectRowList.length>0">
                            批量审批
                        </button>
                        <button class="btn btn-default" type="button" ng-click="batchRejected()" ng-disabled="!dataSummary.selectRowList.length>0">
                            批量驳回
                        </button>
                    </div>
                    <div class="btn-group btn-group-xs " permission-buttons="btnExport">
                    </div>
                </div>
            </div>
            <div class="btn-group btn-group-xs ">
                <button class="btn btn-primary" ng-click="fullWindow($event)"><i class="fa fa-square-o"></i>数据全屏
                </button>
            </div>
        </div>
        <!---------------------  / .按钮  --->
        <div main-scroll-style data-des="此节点必需－用户计算滚动区域高度">
            <div class="nicescroll-height  bg-white " ng-nicescroll
                 nice-option="{{niceOpction}}" data-des="此节点必需-滚动内容及指令">
                <div class="col-xs-12 col-md-12" style="margin-right: -1px; height: 100%; ">


                    <div class="col-xs-12 col-md-12 br p0">
                        <ul class="nav nav-tabs" id="tab">
                            <li class="active">
                                <a data-toggle="tab" href="#summary"><i class="fa fa-list-alt"></i>
                                    <label>审批汇总</label></a>
                            </li>

                            <li>
                                <a data-toggle="tab" href="#detail"><i class="fa fa-list-alt"></i>
                                    <label>审批明细</label></a>
                            </li>
                        </ul>

                        <div class="tab-content" id="tabContent">

                            <div  ng-class="['tab-pane', tab.active==0?'active':'']"  id="summary">
                                <div class=" mt10 pb5  oh" data-des="此节点必需－用于识别输入表单的指令">

                                    <!--第一步分统计数据 start-->
                                    <div class="data-table">
                                        <div base-data-table="dataSummary"
                                             data-url="findProcessSummaryNPPInfo" data-show-index='true'
                                             ng-params="params"
                                             data-checked-type="checkbox"
                                             ng-model="currentModel"
                                             data-keys="{key:'taskIds',value:'taskIds'}"
                                             data-callback="[{value:'bpm_title',callback:'clickColumns'}]"
                                             data-legend='[
                                                {"value": "groupCode","name": "部门编号"},
                                                {"value": "groupDesc","name": "部门名称"},
                                                {"value": "advanceAmount","name": "采购确认代垫费用"},
                                                {"value": "receiveAmount","name": "应收金额(含加成)"},
                                                {"value": "unconfirmAmount","name": "需采购确认收取金额(含加成)"}
                                                ]'>
                                        </div>
                                    </div>

                                    <form  name="approvalForm"  id="approvalForm" >
                                        <div class="modal fade" id="approvalFormModal" data-backdrop="static" tabindex="-1">
                                            <div class="modal-dialog modal-dialog-md">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                                            &times;
                                                        </button>
                                                        <h4 class="modal-title">
                                                            {{ apporvalParamsBtn }}
                                                        </h4>
                                                    </div>

                                                    <div class="modal-body ">
                                                        <div class="pl30 pr30">
                                                            <div class="row">
                                                                <div class="form-group col col-xs-12 col-md-12">
                                                                    <div class="input-group input-group-xs">
                                                                        <label class="input-group-addon bn"><span
                                                                                class=""><i class="red">*</i>{{ $l('审批意见') }}：</span></label>

                                                                        <textarea class="radius3-4 w100p" rows="4" ng-model="addParams.opinion" name="addParams_userName">

                                                                        </textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col col-xs-12 col-md-12" ng-if="false">
                                                                    <div class="input-group input-group-xs">
                                                                        <label class="input-group-addon bn"><span
                                                                                class="">{{ $l('快捷回复') }}：</span></label>
                                                                        <select class="form-control radius3 " ng-model="showParams.opinion"
                                                                                ng-change="toOpinion()" name="addParams_Opinion">
                                                                            <option value="{{ val }}" ng-repeat="val in OpinionsList">{{ val }}</option>


                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="modal-footer ">
                                                        <div style="text-align:center">
                                                            <button style="" type="button" class="btn btn-default" data-dismiss="modal"
                                                                    aria-hidden="true">{{ $l('取消')}}
                                                            </button>
                                                            <button type="button" ng-click="btnApproval()"
                                                                    validate-form-btn="approvalForm" class="btn btn-primary mr10"> 确定
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div><!-- /.modal -->
                                    </form>

                                    <!--第一步分统计数据 end-->




                                </div>
                            </div>


                            <!-- 审批明细 start -->
                            <div ng-class="['tab-pane', tab.active==1?'active':'']"  id="detail">
                                <form class="  m10" ng-submit="nPPTable.getData()">
<!--                                    <div class="form-group col-xs-6 col-md-4 col-lg-3">
                                        <div class="input-group input-group-xs">
                                            <label class="input-group-addon bn"><span
                                                    class="w120">促销区间：</span></label>
                                            <input  type="text" ng-model="params.promotionSection"
                                                    class="form-control radius3">

                                        </div>
                                    </div>-->
                                    <div class="form-group col-xs-6 col-md-4 col-lg-3">
                                        <div class="input-group input-group-xs">
                                            <label class="input-group-addon bn"><span
                                                    class="w100">供应商编号:</span></label>
                                            <input  type="text" ng-model="params.priorVendorCode"
                                                    class="form-control radius3">

                                        </div>
                                    </div>

                                    <div class="form-group col-xs-6 col-md-4 col-lg-3">
                                        <div class="input-group input-group-xs">
                                            <label class="input-group-addon bn"><span
                                                    class="w100">产品编号:</span></label>
                                            <input  type="text" ng-model="params.itemCode"
                                                    class="form-control radius3">

                                        </div>
                                    </div>
                                    <div class="row"></div>
                                </form>

                                <div class="data-table">
                                    <!-- data-checked-type="checkbox"-->
                                    <div base-data-table="nPPTable"
                                         ng-params="params"
                                         data-keys="{'key':'nppId','value':'nppId','name':'NPPID'}"
                                         data-show-index="true"
                                         data-auto-request="false"
                                         data-url="findProcessTtaNppInfo"
                                         data-legend="[
                                                {'value':'batchCode','name':'批次编号'},
                                                {'value':'month','name':'Month'},
                                                {'value':'storeCoun','name':'店铺数量'},
                                                {'value':'groupCode','name':'GROUP_CODE'},
                                                {'value':'groupDesc','name':'GROUP_DESC'},
                                                {'value':'deptCode','name':'DEPT_CODE'},
                                                {'value':'deptDesc','name':'DEPT_DESC'},
                                                {'value':'itemCode','name':'产品编号'},
                                                {'value':'itemDescCn','name':'产品名称'},
                                                {'value':'brandCn','name':'品牌_CN'},
                                                {'value':'brandEn','name':'品牌_EN'},
                                                {'value':'vendorNbr','name':'供应商编号'},
                                                {'value':'vendorName','name':'供应商名称'},
                                                {'value':'parentVendorCode','name':'拆分前的VENDOR_CODE'},
                                                {'value':'parentVendorName','name':'拆分前的VENDOR_NAME'},
                                                {'value':'activity','name':'活动内容'},
                                                {'value':'ctw','name':'Non-CVW/CVW<br>非寄售经仓/寄售经仓'},
                                                {'value':'eb','name':'EB /Non-EB<br>独家产品/非独家产品'},
                                                {'value':'contractTerms','name':'合同条款'},
                                                {'value':'collectWayName','name':'收取方式'},
                                                {'value':'chargeStandards','name':'收费标准'},
                                                {'value':'chargeUnitName','name':'收费单位'},
                                                {'value':'receiveAmount','name':'应收金额(不含加成)'},
                                                {'value':'receiveAmountAdd','name':'应收金额(含加成)'},
                                                {'value':'originalBeforeAmount','name':'原应收金额(不含加成)'},
                                                {'value':'unconfirmAmount','name':'采购确认收取金额(不含加成'},
                                                {'value':'unconfirmAmountA','name':'采购确认收取金额(含加成)'},
                                                {'value':'affirmTotStoreCount','name':'采购确认TOTAL店铺数'},
                                                {'value':'addReceiveAmount','name':'追加应收金额'},
                                                {'value':'collectSelect','name':'TTA/OnTop'},
                                                {'value':'sourceFilename','name':'文件'},
                                                {'value':'difference','name':'差异（仅计算负数)'},
                                                {'value':'purchaseName','name':'采购行动'},
                                                {'value':'exemptionReasonName','name':'豁免原因_1'},
                                                {'value':'exemptionReason2Name','name':'豁免原因_2'},
                                                {'value':'debitOrderCode','name':'借记单编号'},
                                                {'value':'aboiReceipts','name':'ABOI系统实收金额'},
                                                {'value':'remark','name':'备注'},
                                                {'value':'currentUserName','name':'当前审批人'},
                                                {'value':'transferInPersonName','name':'转办人(转入)'},
                                                {'value':'transferInDate','name':'转办时间(转入)'},
                                                {'value':'transferOutPersonName','name':'转办人(转出)'},
                                                {'value':'transferOutDate','name':'转办时间(转出)'},
                                                {'value':'transferLastPersonname','name':'转办人(LAST_转出)'},
                                                {'value':'transferLastDate','name':'转办时间(LAST_转出)'},
                                                {'value':'createdByName','name':'创建人'},
                                                {'value':'creationDate','name':'创建时间'},
                                                {'value':'lastUpdatedByName','name':'更新人'},
                                                {'value':'lastUpdateDate','name':'更新时间'},
                                                {'value':'additionRate','name':'加成比例'}
                                                ]">
                                    </div>
                                </div>

                                <!--<form id="dMReportForm" name="dMReportForm">
                                    &lt;!&ndash;<div style="">&ndash;&gt;
                                    <div id ="parentFixedId" style="" main-scroll-style>
                                        &lt;!&ndash;
                                                                    <div id ="fixedId" class="data-table" ng-nicescroll="" id="nicescroll_tta_oi_cw" nice-option="{oneaxismousemode:true,railvalign: 'bottom',cursorcolor:'#1e90c2'}">
                                        &ndash;&gt;
                                        <div id ="fixedId" style =" height: auto;overflow:auto;position:relative" class="data-table" nice-option="{oneaxismousemode:true,railvalign: 'bottom',cursorcolor:'#1e90c2',cursorwidth:'10px',autohidemode:false,zindex:10}" >

                                            <table saaf-table="nPPTable"
                                                   data-url="findProcessTtaNppInfo"
                                                   data-after-get-data="afterGetData()"
                                                   data-params="params"
                                                   data-checked-type="radio"
                                                   data-auto-get-data="true"
                                                   data-page-rows="300"
                                                   class=" nicescroll-height  table table-bordered table-hover table-condensed"
                                                   id="dmTableId" >
                                                <thead class="bg-gray-white">
                                                <tr class="text-center">
                                                    &lt;!&ndash;<th>
                                                        <input  ng-checked="selectedAll" type="checkbox"
                                                                ng-click="checkedAll($event)" >
                                                    </th>&ndash;&gt;
                                                    <th>序号</th>
                                                    <th>批次编号</th>
                                                    <th>流程单据号</th>
                                                    <th>流程状态</th>
                                                    <th>促销档期</th>
                                                    <th>促销开始日期</th>
                                                    <th>促销结束日期</th>
                                                    <th>DM页码</th>
                                                    <th>促销位置</th>
                                                    <th>生效区域</th>
                                                    <th>生效区域数</th>
                                                    <th>活动内容</th>
                                                    <th>图位</th>
                                                    <th>GROUP_DESC</th>
                                                    <th>Category（品类）</th>
                                                    <th>产品编号</th>
                                                    <th>中文名称</th>
                                                    <th>品牌</th>
                                                    <th>优先供应商编号</th>
                                                    <th>优先供应商名称</th>
                                                    <th>合同年份</th>
                                                    <th>合作状态</th>
                                                    <th>合同条款</th>
                                                    <th>收费标准</th>
                                                    <th>拆分前供应商编码</th>
                                                    <th>拆分前供应商名称</th>
                                                    <th>收取方式</th>
                                                    <th>计费金额</th>
                                                    <th>应收金额</th>
                                                    <th>需采购确认收取金额</th>
                                                    <th>采购确认代垫费用</th>
                                                    <th>代垫费用表编号</th>
                                                    <th>差异</th>
                                                    <th><div style="width: 170px;">文件</div></th>
                                                    <th><div style="width: 170px;">文件操作</div></th>
                                                    <th>采购行动</th>
                                                    <th>豁免原因_1</th>
                                                    <th>豁免原因_2</th>
                                                    <th>借记单编号</th>
                                                    <th>实收金额</th>
                                                    <th>转办人(转入)</th>
                                                    <th>转办时间(转入)</th>
                                                    <th>转办人(转出)</th>
                                                    <th>转办时间(转出)</th>
                                                    <th>转办人(LAST_转出)</th>
                                                    <th>转办时间(LAST_转出)</th>
                                                    <th>创建人</th>
                                                    <th>创建时间</th>
                                                    <th>更新人</th>
                                                    <th>更新时间</th>
                                                </tr>
                                                </thead>
                                                <tbody ng-show="nPPTable.data">
                                                <tr class="text-center" ng-repeat="row in nPPTable.data"
                                                    ng-class="{'active':nPPTable.data.selectRow==$index}"
                                                    ng-click="nPPTable.data.selectRow=$index;
                                                                         nPPTable.data.selectRowData =row;" >
                                                    &lt;!&ndash;<td>
                                                        <input id="{{ nPPTable +'_'+row.cwId}}" ng-checked="row.checked" type="checkbox"
                                                               ng-click="check(row,$event)" name="keys">
                                                    </td>&ndash;&gt;
                                                    <td ng-bind="$index+1" class="w50">1</td>
                                                    <td><span>{{row.batchCode}}</span></td>
                                                    <td><a href="javascript:" ng-click="getRow(row)">{{row.processCode}}</a></td>
                                                    <td>{{row.processStatusName}}</td>
                                                    <td><span>{{row.durationPeriod}}</span></td>
                                                    <td><span>{{row.promotionStartDate}}</span></td>
                                                    <td><span>{{row.promotionEndDate}}</span></td>
                                                    <td><span>{{row.dmPage}}</span></td>
                                                    <td><span>{{row.locationCode}}</span></td>
                                                    <td><span>{{row.effectiveArea}}</span></td>
                                                    <td><span>{{row.effectiveAreaCnt}}</span></td>
                                                    <td>
                                                        <span ng-if="!(userType == '45')">{{row.content}}</span>
                                                        <div class="input-group input-group-xs"  ng-if="userType == '45'" style="width: 400px;">
                                                            <input class="form-control input-xs"
                                                                   ng-model="row.content">
                                                        </div>
                                                    </td>
                                                    <td><span>{{row.acceptUnit}}</span></td>
                                                    <td><span>{{row.groupDesc}}</span></td>
                                                    <td><span>{{row.deptDesc}}</span></td>
                                                    <td><span>{{row.itemNbr}}</span></td>
                                                    <td><span>{{row.itemCn}}</span></td>
                                                    <td><span>{{row.brandCn}}</span></td>
                                                    <td><span>{{row.priorVendorCode}}</span></td>
                                                    <td><span>{{row.priorVendorName}}</span></td>
                                                    <td><span>{{row.contractYear}}</span></td>
                                                    <td><span>{{row.contractStatus}}</span></td>
                                                    <td><span>{{row.contractTerms}}</span></td>
                                                    <td><span>{{row.chargeStandards}}</span></td>
                                                    <td><span>{{row.parentVendorCode}}</span></td>
                                                    <td><span>{{row.parentVendorName}}</span></td>
                                                    <td>
                                                        <div class="input-group input-group-xs" style="width: 84px;">
                                                            <div lookup-code="TTA_COLLECTION_METHOD" data-first-text="请选择"  ng-model="row.collect" required
                                                                 data-paramcallback="changeCollectionMethod"
                                                                 data-row="{{nPPTable.data.indexOf(row)}}"
                                                            ></div>
                                                        </div>
                                                    </td>
                                                    <td><span>{{row.chargeMoney | number:0}}</span></td>
                                                    <td><span>{{row.receiveAmount | number:0}}</span></td> &lt;!&ndash;应收金额&ndash;&gt;

                                                    <td>
                                                        &lt;!&ndash;<div class="input-group input-group-xs" style="width: 172px;" >
                                                            <input class="form-control input-xs" ng-required="true"
                                                                   ng-model="row.unconfirmAmount" to-change-number name="{{'unconfirmAmount' + $index}}"
                                                                   ng-click="windowSplit(row)">
                                                        </div> 弹窗&ndash;&gt;
                                                        <div style="width: 150px">
                                                            <input class="form-control input-xs" ng-required="true"
                                                                   ng-model="row.unconfirmAmount" to-change-number name="{{'unconfirmAmount' + $index}}"
                                                                   placeholder="请输入大于0的数,保留两位小数" title="请输入大于0的数,保留两位小数" ng-pattern="/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]{2}$)/"
                                                            >
                                                        </div>
                                                    </td>&lt;!&ndash;需采购确认收取金额&ndash;&gt;

                                                    <td>
                                                        <div style="width: 150px">
                                                            <input class="form-control input-xs" ng-required="true"
                                                                   ng-model="row.advanceAmount" to-change-number name="{{'advanceAmount' + $index}}"
                                                            >
                                                        </div>
                                                    </td> &lt;!&ndash;采购确认代垫费用&ndash;&gt;

                                                    <td>
                                                        <div style="width: 150px">
                                                            <input class="form-control input-xs"
                                                                   ng-model="row.advanceCode"  name="{{'advanceCode' + $index}}"
                                                                   ng-required ="row.advanceAmount>0"
                                                            >
                                                        </div>
                                                    </td>&lt;!&ndash;代垫费用表编号:由采购填写，如果“代垫费用表编号"大于0，则"代垫费用表编号"不能为空&ndash;&gt;
                                                    &lt;!&ndash;
                                                            差异数
                                                            如 “采购确认收取金额(unconfirmAmount)+采购确认代垫费用（advanceAmount）-应收金额（receiveAmount）大于0，为0，
                                                            否则等于“采购确认收取金额（unconfirmAmount）+采购确认代垫费用（advanceAmount）-应收金额
                                                      &ndash;&gt;
                                                    <td>
                                                        <div style="width: 150px">
                                                            <input class="form-control input-xs" ng-required="true"
                                                                   ng-model="row.difference" to-change-number name="{{'difference' + $index}}" disabled
                                                                   ng-value="row.difference = (row.unconfirmAmount * 1 + row.advanceAmount * 1 - row.receiveAmount * 1) > 0 ? 0: (row.unconfirmAmount * 1 + row.advanceAmount * 1 - row.receiveAmount * 1)"
                                                            >
                                                        </div>
                                                    </td>

                                                    <td>
                                                        &lt;!&ndash;<span>{{row.sourceFileName}}</span>&ndash;&gt;
                                                        <input class="form-control input-xs" ng-required="row.collect"
                                                               ng-model="row.sourceFileName"  name="{{'sourceFileName' + $index}}" disabled
                                                        >
                                                    </td>
                                                    <td>
                                                        &lt;!&ndash;<button type="button"  ng-click="uploadFile()" class="btn btn-primary btn-xs"  id="addRelSupplierButton"><i class="fa fa-plus">上传附件</i></button>&ndash;&gt;
                                                        <a  type="button" ng-click="downFileEvent(row)" style="cursor:pointer;white-space:nowrap">
                                                            <i  class="fa  fa-download"></i></a>
                                                        <a  type="button" ng-click="callback(row,$index,'upload')" style="cursor:pointer;white-space:nowrap">
                                                            <i  class="fa fa-upload"></i></a>
                                                        <a  type="button" ng-click="delUploadFile(row)" style="cursor:pointer;white-space:nowrap">
                                                            <i  class="fa fa-remove"></i></a>
                                                    </td>
                                                    <td>

                                                        <div class="input-group input-group-xs" style="width: 172px;">
                                                            &lt;!&ndash;<div lookup-code="TTA_CW_ACTION" data-first-text="请选择"  data-callback="purchaseFun"    ng-model="row.purchase" required></div>&ndash;&gt;
                                                            <div class="input-group input-group-xs">
                                                                <div lookup-code="TTA_DM_ACTION"
                                                                     required name="{{'purchase'+$index}}"
                                                                     data-first-text="请选择"
                                                                     data-paramcallback="purchaseFun"
                                                                     data-row="{{nPPTable.data.indexOf(row)}}"
                                                                     ng-model="row.purchase"></div>
                                                            </div>
                                                        </div>

                                                    </td>
                                                    <td>
                                                        <div class="input-group input-group-xs" style="width: 172px;">
                                                            <select class     ="form-control radius3"
                                                                    ng-change ="exemptionReasonListChangeIn(row,row.exemptionReasonList,row.exemptionReason)"
                                                                    ng-required="row.exemptionReasonList && row.exemptionReasonList.length>0"
                                                                    ng-model  ="row.exemptionReason">
                                                                <option value ="">{{firstText}}</option>
                                                                <option ng-bind="iterm.meaning"
                                                                        ng-repeat="iterm in row.exemptionReasonList"
                                                                        value="{{iterm.lookupCode}}"></option>
                                                            </select>
                                                        </div>
                                                    </td>
                                                    <td title="{{row.exemptionReason2}}">
                                                        <div class="input-group input-group-xs" style="width: 172px;">
                                                            &lt;!&ndash;<div lookup-code="TTA_CW_REASON1" data-first-text="请选择"    ng-model="row.exemptionReason2" required></div>&ndash;&gt;
                                                            <select class     ="form-control radius3"
                                                                    ng-required="row.exemptionReasonList2 && row.exemptionReasonList2.length>0"
                                                                    ng-model  ="row.exemptionReason2">
                                                                <option value ="">{{firstText}}</option>
                                                                <option ng-bind="iterm.meaning"
                                                                        ng-repeat="iterm in row.exemptionReasonList2"
                                                                        value="{{iterm.lookupCode}}"></option>
                                                            </select>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span ng-if="!(userType == '45')">{{row.debitOrderCode}}</span>
                                                        <div class="input-group input-group-xs" style="width: 172px;" ng-if="userType == '45'">
                                                            <input class="form-control input-xs"
                                                                   ng-model="row.debitOrderCode">
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span ng-if="!(userType == '45')">{{row.receipts}}</span>
                                                        <div class="input-group input-group-xs" style="width: 172px;" ng-if="userType == '45'">
                                                            <input class="form-control input-xs"
                                                                   ng-model="row.receipts">
                                                        </div>
                                                    </td>
                                                    <td><span>{{row.transferInPersonName}}</span></td>
                                                    <td><span>{{row.transferInDate}}</span></td>
                                                    <td><span>{{row.transferOutPersonName}}</span></td>
                                                    <td><span>{{row.transferOutDate}}</span></td>
                                                    <td><span>{{row.transferLastPersonName}}</span></td>
                                                    <td><span>{{row.TransferLastDate}}</span></td>
                                                    <td><span>{{row.createdByName}}</span></td>
                                                    <td><span>{{row.creationDate}}</span></td>
                                                    <td><span>{{row.lastUpdatedByName}}</span></td>
                                                    <td><span>{{row.lastUpdateDate}}</span></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            <div saaf-table-tfoot="nPPTable" ng-show="nPPTable.data.length>0"></div>

                                        </div>
                                    </div>
                                </form>-->
                            </div>
                             <!-- 审批明细 end -->

                        </div>

                    </div>


                    <!--导出功能 start-->
                    <div class="tab-pane fade in active col-md-12" id="dm" ng-show="false">
                        <div class="data-table">
                            <!-- data-checked-type="checkbox"-->
                            <div class="data-table" ng-show="false">
                                <div base-data-table="dataTable"
                                     ng-params="params"
                                     data-show-index="true"
                                     data-url="findProcessTtaNppInfo"
                                     data-keys="{key:'nppId'}"
                                     data-legend="[
                                                {'value':'nppId','name':'唯一标识'},
                                                {'value':'batchCode','name':'批次编号'},
                                                {'value':'month','name':'Month'},
                                                {'value':'storeCoun','name':'店铺数量'},
                                                {'value':'groupCode','name':'GROUP_CODE'},
                                                {'value':'groupDesc','name':'GROUP_DESC'},
                                                {'value':'deptCode','name':'DEPT_CODE'},
                                                {'value':'deptDesc','name':'DEPT_DESC'},
                                                {'value':'itemCode','name':'产品编号'},
                                                {'value':'itemDescCn','name':'产品名称'},
                                                {'value':'brandCn','name':'品牌_CN'},
                                                {'value':'brandEn','name':'品牌_EN'},
                                                {'value':'vendorNbr','name':'供应商编号'},
                                                {'value':'vendorName','name':'供应商名称'},
                                                {'value':'parentVendorCode','name':'拆分前的VENDOR_CODE'},
                                                {'value':'parentVendorName','name':'拆分前的VENDOR_NAME'},
                                                {'value':'activity','name':'活动内容'},
                                                {'value':'ctw','name':'Non-CVW/CVW<br>非寄售经仓/寄售经仓'},
                                                {'value':'eb','name':'EB /Non-EB<br>独家产品/非独家产品'},
                                                {'value':'contractTerms','name':'合同条款'},
                                                {'value':'collectWayName','name':'收取方式'},
                                                {'value':'chargeStandards','name':'收费标准'},
                                                {'value':'chargeUnitName','name':'收费单位'},
                                                {'value':'receiveAmount','name':'应收金额(不含加成)'},
                                                {'value':'receiveAmountAdd','name':'应收金额(含加成)'},
                                                {'value':'originalBeforeAmount','name':'原应收金额(不含加成)'},
                                                {'value':'unconfirmAmount','name':'采购确认收取金额(不含加成'},
                                                {'value':'unconfirmAmountA','name':'采购确认收取金额(含加成)'},
                                                {'value':'affirmTotStoreCount','name':'采购确认TOTAL店铺数'},
                                                {'value':'addReceiveAmount','name':'追加应收金额'},
                                                {'value':'collectSelect','name':'TTA/OnTop'},
                                                {'value':'sourceFilename','name':'文件'},
                                                {'value':'difference','name':'差异（仅计算负数)'},
                                                {'value':'purchaseName','name':'采购行动'},
                                                {'value':'exemptionReasonName','name':'豁免原因_1'},
                                                {'value':'exemptionReason2Name','name':'豁免原因_2'},
                                                {'value':'debitOrderCode','name':'借记单编号'},
                                                {'value':'aboiReceipts','name':'ABOI系统实收金额'},
                                                {'value':'remark','name':'备注'},
                                                {'value':'transferInPersonName','name':'转办人(转入)'},
                                                {'value':'transferInDate','name':'转办时间(转入)'},
                                                {'value':'transferOutPersonName','name':'转办人(转出)'},
                                                {'value':'transferOutDate','name':'转办时间(转出)'},
                                                {'value':'transferLastPersonname','name':'转办人(LAST_转出)'},
                                                {'value':'transferLastDate','name':'转办时间(LAST_转出)'},
                                                {'value':'createdByName','name':'创建人'},
                                                {'value':'creationDate','name':'创建时间'},
                                                {'value':'lastUpdatedByName','name':'更新人'},
                                                {'value':'lastUpdateDate','name':'更新时间'},
                                                {'value':'additionRate','name':'加成比例'}
                                                ]"
                                ></div>
                            </div>
                        </div>

                    </div>
                    <!--DM 导出end-->

                </div>

            </div>
        </div>
    </div>

    <!--excel 上传 并更新借记编号，实收金额start -->
    <div class="modal fade" id="excelUp" data-des="EXCEL_UP" data-backdrop="static" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="fileImportId">
                        导入
                    </h4>
                </div>
                <form class="ngValid" name="funcMenuForm"  >
                    <div class="modal-body">
                        <div class="form-group col-xs-12 col-md-12">
                            <div class="input-group input-group-xs">
                                <label class="input-group-addon bn">
                                    <span class="w100">选择文件</span></label>
                                <input type="file" required accept="*.xlsx"  id="fileUpLoad">
                            </div>
                        </div>
                        <div class="cb"></div>
                    </div>

                    <div class="modal-footer ">
                        <div style="text-align:center">
                            <button style="" type="button" class="btn btn-default" data-dismiss="modal">取消
                            </button>
                            <button ng-click="uploadSave(funcMenuForm.$invalid)" validate-form-btn="" data-validate-form="funcMenuForm" class="btn btn-primary mr10">确定</button>
                        </div>
                    </div>
                </form>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <!--excel 上传 并更新借记编号，实收金额end -->

    <!--excel 上传 每行附件上传 start -->
    <div class="modal fade" id="addFileUpload" data-des="文件上传" data-backdrop="static" tabindex="-1">
        <div class="modal-dialog " style="width: 600px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel2">
                        文件上传
                    </h4>
                </div>
                <form class="ngValid" name="funcMenucWForm"  >
                    <div class="modal-body">
                        <div class="form-group col-xs-12 col-md-12">
                            <div class="btn-group btn-group-xs" style="">
                                <input  type="file" id ="cWReportUploadFile" name="cWReportUploadFile"  emms-file-upload="myFile">
                            </div>
                        </div>
                        <div class="cb"></div>
                    </div>

                    <div class="modal-footer ">
                        <div style="text-align:center">
                            <button style="" type="button" class="btn btn-default" data-dismiss="modal">取消
                            </button>
                            <button ng-click="uploadFile(funcMenucWForm.$invalid)" validate-form-btn="" data-validate-form="funcMenucWForm" class="btn btn-primary mr10">确定</button>
                        </div>
                    </div>
                </form>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <!--excel 上传 每行附件上传 end-->

    <div lov-list="userGroupDeptBrandLovList" role="dialog" data-title="用户" id="userGroupDeptBrandLov" ng-model="code1" class="  "
         data-url="itemFind"
         data-params="{findFlag:'userGroupDeptBrand'}"
         data-callback="selecGroupReturn"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-checked-type="checkbox"
         data-keys="{'key':'valueAll','value':'groupCode',name:'GROUP'}"
         data-show-index="false"
         data-other-column="[
            {'name':'GROUP_DESC','key':'groupDesc'},
            {'name':'DEPT','key':'deptCode'},
            {'name':'DEPT_DESC','key':'deptDesc'},
             {'name':'BRAND_CN','key':'brandCn'},
            {'name':'BRAND_EN','key':'brandEn'},
             {'name':'BRAND_CODE','key':'brandCode'}
        ]"
         data-search-key="[
         {'key':'groupCode','placeholder':'GROUP'},
         {'key':'deptCode','placeholder':'DEPT'},
         {'key':'brandCode','placeholder':'BRAND'},
         ]"
    >
    </div>

    <div lov-list="userGroupLovList" role="dialog" data-title="用户" id="userGroupLov" ng-model="code1" class="  "
         data-url="itemFind"
         data-params="{findFlag:'findGroup'}"
         data-callback="selecGroupReturn"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-checked-type="checkbox"
         data-keys="{'key':'groupCode','value':'groupCode',name:'GROUP'}"
         data-show-index="false"
         data-other-column="[
            {'name':'GROUP_DESC','key':'groupDesc'}
        ]"
         data-search-key="[
         {'key':'groupCode','placeholder':'GROUP'},
         {'key':'groupDesc','placeholder':'GROUP_DESC'}
         ]"
    >
    </div>


    <div lov-list="userGroupDeptBrandLovList" role="dialog" data-title="用户" id="userGroupDeptLov" ng-model="code1" class="  "
         data-url="itemFind"
         data-params="{findFlag:'findGroupDept'}"
         data-callback="selecGroupReturn"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-checked-type="checkbox"
         data-keys="{'key':'valueAll','value':'groupCode',name:'GROUP'}"
         data-show-index="false"
         data-other-column="[
            {'name':'GROUP_DESC','key':'groupDesc'},
            {'name':'DEPT','key':'deptCode'},
            {'name':'DEPT_DESC','key':'deptDesc'}
        ]"
         data-search-key="[
         {'key':'groupCode','placeholder':'GROUP'},
         {'key':'deptCode','placeholder':'DEPT'},
         ]"
    >
    </div>

    <div class="modal fade" id="cwSplit" data-des="拆分" data-backdrop="static" tabindex="-1">
        <div class="modal-dialog " style="width: 500px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        请填写
                    </h4>
                </div>
                <form class="ngValid" name="funcMenuForm"  >
                    <div>
                        <label style="margin-left: 10px"><i class="fa fa-list-alt"></i>详情</label>
                        <div  class="btn-group btn-group-xs ml5 pull-right">
                            <button type="button" class="btn btn-default btn-xs " ng-disabled="splitDataTable.selectRow==undefined" ng-click="btnDelRow()"><i class="fa fa-trash-o fa-lg"></i>删除</button>
                            <button type="button" class="btn btn-default btn-xs" ng-click="btnNewRow()"><i class="fa fa-plus">增加</i></button>
                        </div>

                    </div>


                    <div class="data-table">
                        <table
                                class="table table-bordered table-hover table-condensed">
                            <thead class="bg-gray-white">
                            <tr class="text-center">
                                <th>采购确认收取金额</th>
                                <th>供应商</th>
                                <th>供应商名称</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="text-center" ng-repeat="row in splitDataTable"
                                ng-class="{'active':splitDataTable.selectRow==$index}"
                                ng-click="splitDataTable.selectRow=$index">
                                <td>
                                    <div class="input-group input-group-xs">
                                        <input class="form-control radius3" ng-model="row.unconfirmAmount" name="{{'unconfirmAmount_split'+$index}}"
                                               required type="text"  to-change-number />
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-xs">
                                    </div>
                                    <div class="input-group input-group-xs">
                                        <input class="form-control radius3" ng-model="row.priorVendorCode" name="{{'priorVendorCode_split'+$index}}"
                                               readonly required type="text"/>
                                        <span class="input-group-btn ng-scope">
                                        <button class="btn btn-default" ng-click="getVendorL()" type="button">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </span>
                                    </div>
                                </td>
                                <td>
                                    <span>{{row.priorVendorName}}</span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="modal-footer " ng-if="buttonFlag">
                        <div style="text-align:center">
                            <button style="" type="button" class="btn btn-default" data-dismiss="modal">取消
                            </button>
                            <button ng-click="saveWindow(funcMenuForm.$invalid)" validate-form-btn="" data-validate-form="funcMenuForm" id="saveButton" class="btn btn-primary mr10">确定</button>
                        </div>
                    </div>
                </form>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <div data-auto-request="true" data-callback="selectSupplierReturn" data-checked-type="radio"
         data-dynamic-params="{flag:'isNew'}" data-keys="{'key':'supplierCode','value':'supplierCode','name':'供应商编码'}"
         data-other-column="[{'name':'供应商名称','key':'supplierName'}]"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-return-type="key"
         data-search-key="[{'key':'supplierCode','placeholder':'供应商编码'},
                          {'key':'supplierName','placeholder':'供应商名称'}]"
         data-show-index="false"
         data-title="选择供应商信息"
         data-type="competitor"
         data-url="supplierFindLov"
         id="cWReportListId"
         lov-list="cWReportList"
         ng-model="current.em"
         role="dialog"
    >
    </div>

    <div data-auto-request="true" data-callback="selectTransferReturn" data-checked-type="radio"
         data-other-column="[{key:'userName',name:'账号'},{key:'userFullName',name:'员工姓名'}]"
         data-pagination="{'pageIndex':'1','pageRows':'5'}"
         data-return-type="key"
         data-search-key="[{'key':'userFullName','placeholder':'请输入员工姓名'},{'key':'userName','placeholder':'请输入员工账号'}]"
         data-show-index="false"
         data-title="选择转办人"
         data-type="competitor"
         data-keys="{'key':'userName','value':'userFullName','name':'账号',hide:'true'}"
         data-url="processFindInternalUsers"
         id="lovcWReportFind"
         lov-list="lovcWReportFind"
         ng-model="current.em"
         role="dialog"
    >
    </div>


</div>