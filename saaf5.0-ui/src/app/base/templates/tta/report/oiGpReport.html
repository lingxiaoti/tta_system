<div ng-controller="oiGpReportCtrl" class="gridtable">



    <div class="form bg-white" inner-frame data-des="此节点必需－内框页面的指令">
        <!--------------------- 按钮--->
        <div class="bg-gray-white p5">
            <div class=" pull-right ml10">
                <div class="btn-group btn-group-xs ml10" id="outputButton">
                    <button class="btn btn-default" type="button" ng-click="search();searchDataTable();">
                        <i class="fa fa-search" aria-hidden="true"></i>{{$l('搜索')}}
                    </button>

                    <button class="btn btn-default btn-xs" id="confirmData" type="button"  ng-click="confirmData('Y')">
                        <i class="fa fa-check">确认</i>
                    </button>

                    <button class="btn btn-default btn-xs" id="cancelConfirmData"  type="button" ng-click="confirmData('N')" ng-if="userType =='45'"><!--BIC开放-->
                        <i class="fa fa-arrows-h">取消确认</i>
                    </button>

                    <!--<button type="button" class="btn btn-default" permission-btn=""  ng-click="btnBz()" ></button>--> <!--转办-->
                    <button type="button" class="btn btn-default" permission-btn=""  ng-click="btnSave(dMReportForm)" ></button>
                    <!--<button type="button" class="btn btn-default" permission-btn=""  ng-click="btnSd()" ></button> --> <!-- 锁定-->
                    <!--<button type="button" class="btn btn-default" permission-btn=""  ng-click="btnWcqk()" ></button>--><!-- 完成情况-->
                    <div class="btn-group btn-group-xs " permission-buttons="btnExport">

                    </div>
                </div>
            </div>
            <div class="btn-group btn-group-xs ">
                <button class="btn btn-primary" ng-click="fullWindow($event)"><i class="fa fa-square-o"></i>数据全屏
                </button>
            </div>
        </div>
        <!---------------------  / .按钮  --->
        <div main-scroll-style data-des="此节点必需－用户计算滚动区域高度">
            <div class="nicescroll-height  bg-white " ng-nicescroll
                 nice-option="{{niceOpction}}" data-des="此节点必需-滚动内容及指令">
                <div class="col-xs-12 col-md-12" style="margin-right: -1px; height: 100%; ">

                   <!-- <form class="  m10" ng-submit="cWTable.getData()">
                        <div class="form-group col-xs-6 col-md-4 col-lg-3">
                            <div class="input-group input-group-xs">
                                <label class="input-group-addon bn"><span
                                        class="w100">供应商编号:</span></label>
                                <input  type="text" ng-model="params.venderCode"
                                        class="form-control radius3">

                            </div>
                        </div>
                        <div class="form-group col-xs-6 col-md-4 col-lg-3">
                            <div class="input-group input-group-xs">
                                <label class="input-group-addon bn"><span
                                        class="w100">供应商名称:</span></label>
                                <input  type="text" ng-model="params.venderName"
                                        class="form-control radius3">

                            </div>
                        </div>
                        <div class="row"></div>
                    </form>-->

                    <!--第一部分报表 start-->
                    <div class="col-xs-12 col-md-12" style="margin-right: -1px;" ng-if="userType == '45'">
                        <div class="data-table" id="dataDiv"  ng-nicescroll=""
                             nice-option="{oneaxismousemode:true,railvalign: 'bottom',cursorcolor:'#1e90c2',cursorwidth:'10px',autohidemode:false,zindex:10}">
                            <form name="dataForm" id="dataForm">
                                <table class="table table-bordered table-hover table-condensed" id = "dataTableId"
                                >
                                    <thead class="bg-gray-white">
                                    <tr class="text-center" style="background: #9BC2E6">
                                        <th ng-repeat="row in headList track by $index">{{row}}</th>
                                    </tr>
                                    </thead>
                                    <tbody id="tbodyId">
                                        <tr name="tr_{{$index}}" class="text-center" ng-repeat="row in dataList track by $index">
                                            <td  ng-repeat="childRow in row track by $index">
                                                {{childRow}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </form>
                        </div>
                    </div>
                    <!--第一部分报表 end-->


                    <!--第二部分报表 start-->
                    <div >
                        <div class=""
                             data-des="此节点必需-滚动内容及指令">
                            <div class="col-xs-12 col-md-12" style="margin-right: -1px; height: 100%; ">
                                <div class=" mt10 pb5 input-form bb oh" input-form
                                     data-des="此节点必需－用于识别输入表单的指令">
                                </div>
                                <div id ="proposalStatusParentId" style="" main-scroll-style data-des="此节点必需－用户计算滚动区域高度">
                                    <div id ="proposalStatusId" class="data-table" ng-nicescroll="" id="nicescroll_userGroupDeptBrand"
                                         nice-option="{{niceOpction}}"
                                    >
                                        <!--第2部分报表 start-->
                                        <form id="dMReportForm" name="dMReportForm">
                                            <!--<div style="">-->
                                            <div id ="parentFixedId" style="" main-scroll-style>
                                                <div id ="fixedId" style =" height: auto;overflow:auto;position:relative" class="data-table" nice-option="{oneaxismousemode:true,railvalign: 'bottom',cursorcolor:'#1e90c2',cursorwidth:'10px',autohidemode:false,zindex:10}" >

                                                    <table saaf-table="cWTable"
                                                           data-url="findTtaGpInfo"
                                                           data-after-get-data="afterGetData()"
                                                           data-params="params"
                                                           data-checked-type="radio"
                                                           data-auto-get-data="true"
                                                           data-page-rows="15"
                                                           class=" nicescroll-height  table table-bordered table-hover table-condensed"
                                                           id="dmTableId" >
                                                        <thead class="bg-gray-white">
                                                        <tr class="text-center">
                                                            <th>
                                                                <input  ng-checked="selectedAll" type="checkbox"
                                                                        ng-click="checkedAll($event)" >
                                                            </th>
                                                            <th>序号</th>
                                                            <th>批次编号</th>
                                                            <th>proposal单号</th>
                                                            <th>proposal版本号</th>
                                                            <th>供应商编码</th>
                                                            <th>供应商名称</th>
                                                            <th>GROUP_DESC</th>
                                                            <th>DEPT_DESC</th>
                                                            <th>BRAND_CN</th>
                                                            <th>BRAND_EN</th>
                                                            <th>OWNER_DEPT</th>
                                                            <th>销售方式</th>
                                                            <th>TTA GP%</th>

                                                            <th>Sales</th>
                                                            <th>GP$</th>

                                                            <th>Sales$</th>
                                                            <th>GP$</th>
                                                            <th>Act. GP%</th>
                                                            <th>Actual GP% vs TTA GP%</th>
                                                            <th>GP$ Loss</th>
                                                            <th>BIC remark</th>
                                                            <th>Action Code</th>
                                                            <th>Reason for GP$ Loss</th>
                                                            <th>Action Plan</th>
                                                            <th>Target Completion Timeline</th>
                                                            <th>确认状态</th>
                                                            <th>确认/取消人</th>
                                                            <th>确认/取消时间</th>
                                                            <th>创建人</th>
                                                            <th>创建时间</th>
                                                            <th>更新人</th>
                                                            <th>更新时间</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody ng-show="cWTable.data">
                                                        <tr class="text-center" ng-repeat="row in cWTable.data"
                                                            ng-class="{'active':cWTable.data.selectRow==$index}"
                                                            ng-click="cWTable.data.selectRow=$index;cWTable.data.selectRowData =row;" >
                                                            <td>
                                                                <input id="{{ cWTable +'_'+row.simulationId}}" ng-checked="row.checked" type="checkbox"
                                                                       ng-click="check(row,$event)" name="keys">
                                                            </td>
                                                            <td ng-bind="$index+1" class="w50"></td>
                                                            <td><span>{{row.batchCode}}</span></td>
                                                            <td><span>{{row.orderNbr}}</span></td>
                                                            <td><span>{{row.versionCode}}</span></td>
                                                            <td><span>{{row.vendorNbr}}</span></td>
                                                            <td><span>{{row.vendorName}}</span></td>
                                                            <td><span>{{row.groupName}}</span></td>
                                                            <td><span>{{row.deptDesc}}</span></td>
                                                            <td><span>{{row.brandCn}}</span></td>
                                                            <td><span>{{row.brandEn}}</span></td>
                                                            <td><span>{{row.majorDeptDesc}}</span></td>
                                                            <td><span>{{row.salesTypeName}}</span></td>
                                                            <td><span>{{row.gpRate}}</span></td><!-- TTA GP% -->
                                                             
                                                            <td>
                                                                <span>{{row.propSalesAmt}}</span>
                                                            </td><!--预期Sales-->

                                                            <td>
                                                                <span>{{row.propGpAmt}}</span>
                                                            </td><!-- 预期GP$-->

                                                            <td>
                                                                <input ng-disabled="true"  ng-model="row.salesExcludeAmt"   style="width: 90px;"  class="form-control input-xs"  to-change-number type="text" ng-disabled="row.confirmStatus == 'Y'">
                                                            </td>

                                                            <td>
                                                                <input ng-disabled="true"  ng-model="row.gp"   class="form-control input-xs"  style="width: 90px;"  to-change-number type="text" ng-disabled="row.confirmStatus == 'Y'">
                                                            </td>

                                                            <td>
                                                                <!--Act. GP%-->
                                                                <!--<input class="form-control input-xs" ng-required="true" disabled  style="width: 90px;"  ng-value="(row.gp/row.salesExcludeAmt)*100 ? ((row.gp/row.salesExcludeAmt)*100).toFixed(2) : ''  ">-->

                                                                <input class="form-control input-xs" ng-required="true" disabled  style="width: 90px;" to-change-number ng-model="row.actGpValue" ng-disabled="row.confirmStatus == 'Y'" />
                                                            </td>

                                                            <td>
                                                                <!--Actual GP% vs TTA GP%-->
                                                                <!-- <input class="form-control input-xs" ng-required="true" disabled  style="width: 90px;"  ng-value="((row.gp/row.salesExcludeAmt)*100-row.gpRate) ? ((row.gp/row.salesExcludeAmt)*100-row.gpRate).toFixed(2): '' "> -->
                                                                <input class="form-control input-xs" ng-required="true" disabled  style="width: 90px;" to-change-number ng-model="row.gpVsValue" ng-disabled="row.confirmStatus == 'Y'"/>
                                                            </td>

                                                            <td>
                                                                <!--GP$ Loss-->
                                                                <!--<input class="form-control input-xs" ng-required="true" disabled  style="width: 90px;"  ng-value="(((row.gp/row.salesExcludeAmt)*100-row.gpRate)* row.salesExcludeAmt/100) ? (((row.gp/row.salesExcludeAmt)*100-row.gpRate)* row.salesExcludeAmt/100).toFixed(2):''">-->
                                                                <input class="form-control input-xs" ng-required="true" disabled  style="width: 90px;" to-change-number ng-model="row.gpLoss" ng-disabled="row.confirmStatus == 'Y'" />
                                                            </td>

                                                            <td>
                                                                <!--BIC录入-->
                                                                <span ng-if="userType != '45'">{{row.remark}}</span>
                                                                <div class="input-group input-group-xs" style="width: 120px;" ng-if="userType == '45'">
                                                                    <input class="form-control input-xs"  ng-model="row.remark" ng-disabled="row.confirmStatus == 'Y'">
                                                                </div>
                                                            </td>

                                                            <td>
                                                                <div class="input-group input-group-xs" style="width: 84px;">
                                                                    <div lookup-code="TTA_ACTION_CODE" data-first-text="请选择"  ng-model="row.actionCode" required  ng-disabled="row.confirmStatus == 'Y'"
                                                                         data-paramcallback="changeCollectionMethod"
                                                                         data-row="{{cWTable.data.indexOf(row)}}"
                                                                    ></div>
                                                                </div>
                                                            </td>

                                                            <td>
                                                                <div class="input-group input-group-xs" style="width: 84px;">
                                                                    <div lookup-code="TTA_REASON_GP" data-first-text="请选择"  ng-model="row.gpReasonCode" required  ng-disabled="row.confirmStatus == 'Y'"
                                                                         data-paramcallback="changeCollectionMethod"
                                                                         data-row="{{cWTable.data.indexOf(row)}}"
                                                                    ></div>
                                                                </div>
                                                            </td>

                                                            <td>
                                                                <!--	Action Plan -->
                                                                <div class="input-group input-group-xs"  style="width: 120px;">
                                                                    <input class="form-control input-xs"  ng-disabled="row.confirmStatus == 'Y'"  ng-model="row.actionPlan">
                                                                </div>
                                                            </td>

                                                            <td>
                                                                <!--	Target Completion Timeline	 -->
                                                                <input type="text" class="form-control radius3 input-xs"  ng-disabled="row.confirmStatus == 'Y'"
                                                                       date-time-picker data-is-today="false" name="targetDate"
                                                                       data-date-format="yyyy-mm-dd"
                                                                       data-min-View="2" ng-model="row.targetDate">
                                                            </td>
                                                            <td><span>{{row.confirmStatus}}</span></td>
                                                            <td><span>{{row.confirmUserName}}</span></td>
                                                            <td><span>{{row.confirmDate}}</span></td>
                                                            <td><span>{{row.createUserName}}</span></td>
                                                            <td><span>{{row.creationDate}}</span></td>
                                                            <td><span>{{row.updateUserName}}</span></td>
                                                            <td><span>{{row.lastUpdateDate}}</span></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                    <div saaf-table-tfoot="cWTable" ng-show="cWTable.data.length>0"></div>

                                                </div>
                                            </div>
                                        </form>
                                        <!--第2部分报表 end-->
                                    </div>
                                    <div saaf-table-tfoot="proposalProcessTable"
                                         ng-show="proposalProcessTable.data.length>0"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!--第二部分报表 end-->

                    <!--导出功能 start-->
                    <div class="tab-pane fade in active col-md-12" id="dm" ng-show="false">
                        <div class="data-table">
                            <!-- data-checked-type="checkbox"-->
                            <div base-data-table="dataTable"
                                 ng-params="params"
                                 data-keys="{'key':'simulationId','value':'simulationId','name':'CWID'}"
                                 data-show-index="true"
                                 data-auto-request="true"
                                 data-url="findTtaGpInfo"
                                 data-legend="[
                                            {'value':'batchCode','name':'批次编号'},
                                            {'value':'orderNbr','name':'proposal单号'},
                                            {'value':'versionCode','name':'proposal版本号'},
                                            {'value':'batchCode','name':'供应商编码'},
                                            {'value':'vendorName','name':'供应商名称'},
                                            {'value':'groupName','name':'GROUP_DESC'},
                                            {'value':'deptDesc','name':'DEPT_DESC'},
                                            {'value':'brandCn','name':'BRAND_CN'},
                                            {'value':'brandEn','name':'BRAND_EN'},
                                            {'value':'majorDeptDesc','name':'OWNER_DEPT'},
                                            {'value':'salesTypeName','name':'销售方式'},
                                            {'value':'gpRate','name':'TTA GP%'},
                                            {'value':'salesExcludeAmt','name':'Sales$'},
                                            {'value':'gp','name':'GP$'},
                                            {'value':'actGpValue','name':'Act. GP%'},
                                            {'value':'gpVsValue','name':'Actual GP% vs TTA GP%'},
                                            {'value':'gpLoss','name':'GP$ Loss'},
                                            {'value':'remark','name':'BIC remark'},
                                            {'value':'actionName','name':'Action Code'},
                                            {'value':'gpReasonName','name':'Reason for GP$ Loss'},
                                            {'value':'actionPlan','name':'Action Plan'},
                                            {'value':'targetDate','name':'Target Completion Timeline'},
                                            {'value':'confirmStatus','name':'确认状态'},
                                            {'value':'confirmUserName','name':'确认/取消人'},
                                            {'value':'confirmDate','name':'确认/取消时间'},
                                            {'value':'createUserName','name':'创建人'},
                                            {'value':'creationDate','name':'创建时间'},
                                            {'value':'updateUserName','name':'更新人'},
                                            {'value':'lastUpdateDate','name':'更新时间'},
                                         ]">
                            </div>
                        </div>

                    </div>
                    <!--DM 导出end-->

                </div>

            </div>
        </div>
    </div>


</div>